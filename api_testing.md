# Тестирование API для получения оставшихся запросов пользователя

## Общая информация о API

Мы реализовали эндпоинт `/api/user/requests_left`, который возвращает информацию о количестве оставшихся запросов для текущего пользователя. API требует аутентификации с помощью JWT токена.

## Подготовка к тестированию

### 1. Запуск локального сервера

Прежде чем начать тестирование, убедитесь, что API-сервер запущен на вашем локальном компьютере:

```bash
python api_server.py
```

По умолчанию сервер запускается на порту 5000 (http://localhost:5000).

### 2. Установка Postman

Если у вас ещё не установлен Postman, скачайте его по ссылке: [https://www.postman.com/downloads/](https://www.postman.com/downloads/)

## Тестирование API с помощью Postman

### Шаг 1: Получение JWT токена (аутентификация)

Прежде чем вы сможете получить информацию о количестве оставшихся запросов, вам нужно выполнить аутентификацию и получить JWT токен.

1. Откройте Postman и создайте новый запрос
2. Выберите метод `POST`
3. Введите URL: `http://localhost:5000/api/login`
4. В разделе "Body" выберите "raw" и формат "JSON"
5. Введите данные пользователя в формате JSON:

```json
{
  "username": "ваш_логин",
  "password": "ваш_пароль"
}
```

6. Нажмите "Send" для отправки запроса
7. Вы должны получить ответ с токеном в формате:

```json
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "username": "ваш_логин"
}
```

8. Скопируйте полученный токен (значение поля "token")

### Шаг 2: Получение количества оставшихся запросов

Теперь вы можете использовать полученный токен для доступа к эндпоинту оставшихся запросов:

1. Создайте новый запрос в Postman
2. Выберите метод `GET`
3. Введите URL: `http://localhost:5000/api/user/requests_left`
4. В разделе "Authorization" выберите тип "Bearer Token"
5. Вставьте токен, полученный на предыдущем шаге
6. Нажмите "Send" для отправки запроса

Если всё настроено правильно, вы получите ответ в формате:

```json
{
  "success": true,
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "requests_left": 10
}
```

Значение поля `requests_left` показывает, сколько запросов осталось у пользователя.

## Возможные ошибки и их решение

### 1. Ошибка аутентификации

Если вы получаете ошибку `401 Unauthorized` с сообщением "Токен отсутствует!" или "Недействительный токен", убедитесь, что:

- Вы правильно скопировали токен
- Токен не истек (по умолчанию токен действителен в течение 1 часа)
- Токен передается с префиксом "Bearer " в заголовке Authorization

### 2. Пользователь не найден

Если вы получаете ошибку `404 Not Found` с сообщением "Пользователь не найден", проверьте:

- Правильность данных аутентификации 
- Существует ли пользователь в базе данных

### 3. Проблемы с подключением к серверу

Если вы не можете подключиться к серверу, убедитесь, что:

- Сервер запущен и работает
- Вы используете правильный порт (по умолчанию 5000)
- На вашем компьютере нет брандмауэра или других ограничений, блокирующих соединение

## Дополнительное тестирование

Для более комплексного тестирования вы также можете:

1. Проверить, как меняется количество оставшихся запросов после использования API
2. Протестировать доступ с неверным или истекшим токеном
3. Создать коллекцию тестов Postman для автоматического тестирования

## Выводы

Эндпоинт `/api/user/requests_left` позволяет клиентским приложениям получать информацию о количестве оставшихся запросов для пользователя в реальном времени. Это может быть полезно для информирования пользователей о лимитах использования и подталкивания их к покупке дополнительных запросов или обновлению тарифного плана. 